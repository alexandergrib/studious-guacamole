{% extends "base.html" %}

{% block title %}
    Blog
{% endblock %}

{% block content %}
    {% if not single_post.deleted %}
        <div class="blog-card">
            <div class="card">
                <h2><a href="#"> TITLE: {{ single_post.title }}</a></h2>
                <div class="blog-body">
                    <div class="container justify-content-center">
                        <div class="card">
                            <p>{{ single_post.body }}</p>
                        </div>
                    </div>
                </div>
                <div class="button row justify-content-center mt-3">
                    <div class="col-2">
                        <button type="button" class="btn btn-success"
                                onclick="document.getElementById('add-new-comment').classList.remove('hide')">Add new
                            comment
                        </button>
                    </div>
                </div>


                <div class="add-new-comment hide mt-3" id="add-new-comment">
                    <div class="text-center">
                        <span>Add your comment</span></div>
                    <form method="POST" action="{{ url_for('add_comment') }}">
                        <input type="hidden" value="{{ single_post._id }}" name="single_post_id">
                        <div class="col-md-10 mx-auto">
                            <div class="input-group mb-1">
                                <span class="input-group-text">Post as anonymous?</span>
                                <div class="input-group-text">
                                    <input class="form-check-input mt-0 anonymous_checkbox" type="checkbox"
                                           value="anonymous"
                                           aria-label="Checkbox for following text input" name="anonymous"
                                           id="anonymous_checkbox">
                                </div>

                            </div>
                            <div class="input-group mb-1" id="user_full_name">
                                <span class="input-group-text">First name</span>
                                <input type="text" aria-label="First name" name="f_name" class="form-control"
                                       value="{{ user.f_name }}">
                                <span class="input-group-text"> last name</span>
                                <input type="text" aria-label="Last name" name="l_name" class="form-control"
                                       value="{{ user.l_name }}">
                            </div>
                            <div class="input-group mb-1 hide" id="user_nickname">
                                <span class="input-group-text" id="title">Nickname?</span>
                                <input type="text" class="form-control" placeholder="" aria-label="Title"
                                       aria-describedby="nickname" name="nickname">
                            </div>

                            <div class="input-group mb-1">
                                <span class="input-group-text">Share your thoughts</span>
                                <textarea class="form-control text-field-height" aria-label="With textarea"
                                          name="comment_body" required></textarea>
                            </div>
                            <button type="submit" class="btn btn-success float-end mb-3 mt-1">Add comment</button>
                        </div>
                    </form>
                </div>
                <div class="blog-footer">
                    <p class="comments"><span>Comments: </span>
                        <span>{{ amount_of_comments }}</span>
                        {% if amount_of_comments > 1 %}
                            <span>comments</span>
                        {% else %}
                            <span>comment</span>
                        {% endif %}
                    </p>
                    <ul>
                        {% for item in comments %}
                            {% if not item.deleted %}
                                {% if item.anonymous %}
                                    By:{{ item.nickname }}
                                {% else %}
                                    <li> By:{{ item.username.f_name }} {{ item.username.l_name }}</li>
                                {% endif %}
                            <li>{{ item.comment }}</li>
                                {% if session.user %}
                                    <li class="mb-3">
                                        <a href="{{ url_for('delete_comment', comment_id=item._id ) }}">Delete permanently</a>
        {#                                <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#edit_comment">Edit</button>#}
        {#                                <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#confirmation" id="{{item._id}}"> Delete</button>#}
                                    </li>
                                {% else %}
                                    <li class="mb-3">&nbsp;</li>
                                {% endif %}
                               {% else %}
{#                                display deleted comments #}
                            {% endif %}
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    {% endif %}






<!-- Confirmation Modal -->
<div class="modal fade" id="confirmation" tabindex="-1" aria-labelledby="confirmationLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="confirmationLabel">Are you sure you want to delete?</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <a href="#" type="button" class="btn btn-danger">Yes, delete</a>
      </div>
    </div>
  </div>
</div>



{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src="{{ url_for('static', filename='js/add_new_post.js') }}"></script>
{% endblock %}